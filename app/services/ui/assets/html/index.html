<!DOCTYPE html>
<html>
    <head>
        <title>Testing Metamask Wallet</title>
        <script src="https://c0f4f41c-2f55-4863-921b-sdk-docs.github.io/cdn/metamask-sdk.js"></script>
        <script>
            const sdk = new MetaMaskSDK.MetaMaskSDK({
              dappMetadata: {
                name: "Pure JS example",
                url: window.location.host,
              },
              logging: {
                sdk: false,
              }
            });
        </script>
        <script>
            function hexer(input) {
                const utf8 = toUTF8Array(input);
                const hex = utf8.map(n => n.toString(16));
                return '0x' + hex.join('');
            }

            // From https://stackoverflow.com/a/18729931
            function toUTF8Array(str) {
                var utf8 = [];
                for (var i=0; i < str.length; i++) {
                    var charcode = str.charCodeAt(i);
                    if (charcode < 0x80) utf8.push(charcode);
                    else if (charcode < 0x800) {
                        utf8.push(0xc0 | (charcode >> 6),
                                0x80 | (charcode & 0x3f));
                    }
                    else if (charcode < 0xd800 || charcode >= 0xe000) {
                        utf8.push(0xe0 | (charcode >> 12),
                                0x80 | ((charcode>>6) & 0x3f),
                                0x80 | (charcode & 0x3f));
                    }
                    // surrogate pair
                    else {
                        i++;
                        // UTF-16 encodes 0x10000-0x10FFFF by
                        // subtracting 0x10000 and splitting the
                        // 20 bits of 0x0-0xFFFFF into two halves
                        charcode = 0x10000 + (((charcode & 0x3ff)<<10)
                                | (str.charCodeAt(i) & 0x3ff));
                        utf8.push(0xf0 | (charcode >>18),
                                0x80 | ((charcode>>12) & 0x3f),
                                0x80 | ((charcode>>6) & 0x3f),
                                0x80 | (charcode & 0x3f));
                    }
                }
                return utf8;
            }
        </script>
        <script>
            function connect() {
              ethereum
                .request({
                  method: 'eth_requestAccounts',
                  params: [],
                })
                .then((res) => console.log('request accounts', res))
                .catch((e) => console.log('request accounts ERR', e));
            }

            function accounts() {
              ethereum
                .request({
                  method: 'eth_accounts',
                  params: [],
                })
                .then((res) => console.log('accounts', res))
                .catch((e) => console.log('accounts ERR', e));
            }
          
            function personalSign() {
              ethereum
                .request({
                    method: 'personal_sign',
                    params: [
                        hexer("hello world"),
                        "0x6327a38415c53ffb36c11db55ea74cc9cb4976fd"
                    ],
                })
                .then((res) => console.log('personal sign', res))
                .catch((e) => console.log('personal sign ERR', e));
        }
    </script>
    </head>
    <body>
        <h1>Testing Metamask Wallet 4</h1>
        <button onclick="connect()">Connect</button>
        <button onclick="accounts()">Accounts</button>
        <button onclick="personalSign()">Sign Data</button>
    </body>
</html>